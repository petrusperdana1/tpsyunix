<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Groupy data.js Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .template {
            display: none;
        }
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1e293b;
        }
        ::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
    </style>
</head>
<body class="bg-slate-900 text-white">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-sky-400 mb-2">Groupy data.js Generator</h1>
            <p class="text-slate-400">Buat dan kelola file `data.js` untuk ekstensi Groupy dengan mudah.</p>
        </header>

        <div id="services-container" class="space-y-6">
            <!-- Service items will be appended here -->
        </div>

        <div class="mt-8 flex flex-wrap gap-4 justify-center">
            <button id="add-service-btn" class="bg-sky-500 hover:bg-sky-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-200 flex items-center gap-2">
                <i class="fas fa-plus-circle"></i> Add Service
            </button>
            <button id="generate-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-200 flex items-center gap-2">
                <i class="fas fa-cogs"></i> Generate data.js
            </button>
             <button id="reset-btn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-200 flex items-center gap-2">
                <i class="fas fa-undo"></i> Reset Form
            </button>
        </div>

        <div id="output-container" class="mt-8 hidden">
            <h2 class="text-2xl font-semibold text-sky-400 mb-4">Generated Code</h2>
            <div class="relative">
                <pre><code id="output-code" class="block w-full bg-slate-800 border border-slate-700 rounded-lg p-4 text-sm overflow-x-auto whitespace-pre-wrap break-words"></code></pre>
                <button id="copy-btn" class="absolute top-2 right-2 bg-slate-600 hover:bg-slate-700 text-white font-bold py-1 px-3 rounded-md text-xs transition-colors duration-200">
                    <i class="fas fa-copy mr-1"></i> Copy
                </button>
            </div>
             <div id="copy-feedback" class="text-green-400 text-sm mt-2 text-center hidden">Copied to clipboard!</div>
        </div>
    </div>

    <!-- Template for a single service -->
    <div id="service-template" class="template bg-slate-800 p-6 rounded-lg border border-slate-700 shadow-lg">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold text-sky-500 service-title">New Service</h3>
            <button class="remove-service-btn text-red-400 hover:text-red-500 transition-colors">
                <i class="fas fa-trash-alt fa-lg"></i>
            </button>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label class="block text-sm font-medium text-slate-300 mb-1">Service Name</label>
                <input type="text" class="service-name w-full bg-slate-700 border border-slate-600 rounded-md p-2 text-sm focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none" placeholder="e.g., ChatGPT">
            </div>
            <div>
                <label class="block text-sm font-medium text-slate-300 mb-1">Service URL</label>
                <input type="text" class="service-url w-full bg-slate-700 border border-slate-600 rounded-md p-2 text-sm focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none" placeholder="e.g., https://chatgpt.com/">
            </div>
            <div>
                <label class="block text-sm font-medium text-slate-300 mb-1">Category</label>
                <select class="service-category w-full bg-slate-700 border border-slate-600 rounded-md p-2 text-sm focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none">
                    <option value="productivity">Productivity & AI Tools</option>
                    <option value="streaming">Entertainment</option>
                    <option value="design">Visual Creation</option>
                    <option value="music">Audio & Music</option>
                    <option value="education">Learning</option>
                    <option value="utilities">Essentials</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium text-slate-300 mb-1">Icon URL</label>
                <input type="text" class="service-icon w-full bg-slate-700 border border-slate-600 rounded-md p-2 text-sm focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none" placeholder="e.g., https://example.com/icon.png">
            </div>
        </div>
        <div class="mt-4 flex items-center">
            <input type="checkbox" class="is-group-cb h-4 w-4 text-sky-600 bg-slate-700 border-slate-600 rounded focus:ring-sky-500">
            <label class="ml-2 text-sm text-slate-300">Is this a folder (multiple accounts)?</label>
        </div>
        <div class="single-account-container mt-4">
            <label class="block text-sm font-medium text-slate-300 mb-1">Cookie JSON</label>
            <textarea class="cookies-json w-full h-32 bg-slate-900 border border-slate-600 rounded-md p-2 text-xs font-mono focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none" placeholder="Paste your cookie JSON array here..."></textarea>
        </div>
        <div class="multi-account-container mt-4 hidden">
            <div class="accounts-list space-y-4">
                <!-- Account items will be appended here -->
            </div>
            <button class="add-account-btn mt-4 bg-slate-600 hover:bg-slate-700 text-white font-bold py-2 px-4 rounded-lg text-sm transition-colors flex items-center gap-2">
                <i class="fas fa-plus"></i> Add Account
            </button>
        </div>
    </div>

    <!-- Template for a single account within a folder -->
    <div id="account-template" class="template bg-slate-700 p-4 rounded-lg border border-slate-600">
         <div class="flex justify-between items-center mb-2">
            <h4 class="text-md font-semibold text-slate-300 account-title">New Account</h4>
            <button class="remove-account-btn text-red-400 hover:text-red-500 transition-colors">
                <i class="fas fa-times-circle"></i>
            </button>
        </div>
        <label class="block text-sm font-medium text-slate-300 mb-1">Account Name</label>
        <input type="text" class="account-name w-full bg-slate-600 border border-slate-500 rounded-md p-2 text-sm mb-2 focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none" placeholder="e.g., ChatGPT 1">
        <label class="block text-sm font-medium text-slate-300 mb-1">Cookie JSON</label>
        <textarea class="cookies-json w-full h-24 bg-slate-900 border border-slate-600 rounded-md p-2 text-xs font-mono focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none" placeholder="Paste cookie JSON for this account..."></textarea>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const servicesContainer = document.getElementById('services-container');
            const addServiceBtn = document.getElementById('add-service-btn');
            const generateBtn = document.getElementById('generate-btn');
            const copyBtn = document.getElementById('copy-btn');
            const resetBtn = document.getElementById('reset-btn');
            const outputContainer = document.getElementById('output-container');
            const outputCode = document.getElementById('output-code');
            const copyFeedback = document.getElementById('copy-feedback');

            const serviceTemplate = document.getElementById('service-template');
            const accountTemplate = document.getElementById('account-template');
            
            let serviceCounter = 0;

            const createServiceElement = () => {
                serviceCounter++;
                const newService = serviceTemplate.cloneNode(true);
                newService.id = `service-${serviceCounter}`;
                newService.classList.remove('template');
                newService.querySelector('.service-title').textContent = `Service #${serviceCounter}`;
                
                const isGroupCb = newService.querySelector('.is-group-cb');
                const singleAccountContainer = newService.querySelector('.single-account-container');
                const multiAccountContainer = newService.querySelector('.multi-account-container');
                const addAccountBtn = newService.querySelector('.add-account-btn');
                const accountsList = newService.querySelector('.accounts-list');
                
                let accountCounter = 0;

                isGroupCb.addEventListener('change', () => {
                    singleAccountContainer.classList.toggle('hidden', isGroupCb.checked);
                    multiAccountContainer.classList.toggle('hidden', !isGroupCb.checked);
                });

                addAccountBtn.addEventListener('click', () => {
                    accountCounter++;
                    const newAccount = accountTemplate.cloneNode(true);
                    newAccount.id = `service-${serviceCounter}-account-${accountCounter}`;
                    newAccount.classList.remove('template');
                    newAccount.querySelector('.account-title').textContent = `Account #${accountCounter}`;
                    
                    newAccount.querySelector('.remove-account-btn').addEventListener('click', () => {
                        newAccount.remove();
                    });

                    accountsList.appendChild(newAccount);
                });

                newService.querySelector('.remove-service-btn').addEventListener('click', () => {
                    newService.remove();
                });

                servicesContainer.appendChild(newService);
            };

            const generateDataJs = () => {
                const servicesData = [];
                const serviceElements = servicesContainer.querySelectorAll('.bg-slate-800:not(.template)');
                let hasError = false;

                serviceElements.forEach(serviceEl => {
                    if (hasError) return;

                    const serviceName = serviceEl.querySelector('.service-name').value.trim();
                    if (!serviceName) {
                        alert('Service Name is required for all services.');
                        hasError = true;
                        return;
                    }

                    const serviceObject = {
                        meta: {
                            name: serviceName,
                            url: serviceEl.querySelector('.service-url').value.trim(),
                            category: serviceEl.querySelector('.service-category').value,
                            icon: serviceEl.querySelector('.service-icon').value.trim()
                        }
                    };

                    const isGroup = serviceEl.querySelector('.is-group-cb').checked;

                    if (isGroup) {
                        serviceObject.meta.isGroup = true;
                        serviceObject.accounts = [];
                        
                        const accountElements = serviceEl.querySelectorAll('.accounts-list > div');
                        accountElements.forEach(accountEl => {
                            if (hasError) return;

                            const accountName = accountEl.querySelector('.account-name').value.trim();
                            const cookiesJson = accountEl.querySelector('.cookies-json').value.trim();
                            
                            if (!accountName) {
                                alert(`Account Name is required for all accounts in "${serviceName}".`);
                                hasError = true;
                                return;
                            }
                            if (!cookiesJson) {
                                alert(`Cookie JSON is required for account "${accountName}" in "${serviceName}".`);
                                hasError = true;
                                return;
                            }

                            try {
                                const cookies = JSON.parse(cookiesJson);
                                serviceObject.accounts.push({ name: accountName, cookies: cookies });
                            } catch (e) {
                                alert(`Invalid JSON format for account "${accountName}" in "${serviceName}".\nError: ${e.message}`);
                                hasError = true;
                            }
                        });

                    } else {
                        const cookiesJson = serviceEl.querySelector('.single-account-container .cookies-json').value.trim();
                        if (!cookiesJson) {
                            alert(`Cookie JSON is required for service "${serviceName}".`);
                            hasError = true;
                            return;
                        }
                        try {
                            serviceObject.cookies = JSON.parse(cookiesJson);
                        } catch (e) {
                            alert(`Invalid JSON format for service "${serviceName}".\nError: ${e.message}`);
                            hasError = true;
                        }
                    }

                    if (!hasError) {
                        servicesData.push(serviceObject);
                    }
                });

                if (!hasError) {
                    const outputString = `const servicesData = ${JSON.stringify(servicesData, null, 4)};\n\nexport { servicesData };`;
                    outputCode.textContent = outputString;
                    outputContainer.classList.remove('hidden');
                }
            };

            const copyToClipboard = () => {
                navigator.clipboard.writeText(outputCode.textContent).then(() => {
                    copyFeedback.classList.remove('hidden');
                    setTimeout(() => {
                        copyFeedback.classList.add('hidden');
                    }, 2000);
                }).catch(err => {
                    alert('Failed to copy text.');
                });
            };
            
            const resetForm = () => {
                servicesContainer.innerHTML = '';
                outputContainer.classList.add('hidden');
                outputCode.textContent = '';
                serviceCounter = 0;
                createServiceElement(); // Start with one empty service form
            };

            addServiceBtn.addEventListener('click', createServiceElement);
            generateBtn.addEventListener('click', generateDataJs);
            copyBtn.addEventListener('click', copyToClipboard);
            resetBtn.addEventListener('click', resetForm);
            
            // Initialize with one service form
            createServiceElement();
        });
    </script>
</body>
</html>
