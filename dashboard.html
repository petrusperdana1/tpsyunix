<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Login Success</title>
    <style>
        body { font-family: 'Montserrat', sans-serif; background-color: #121212; color: white; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .container { background-color: #1e1e1e; padding: 40px; border-radius: 10px; text-align: center; width: 100%; max-width: 380px; }
        h2 { font-weight: 600; }
        .success { color: #4CAF50; }
        .error { color: #ff4d4d; }
    </style>
</head>
<body>
    <div class="container">
        <h2 id="status"></h2>
        <p id="message"></p>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const statusElement = document.getElementById('status');
            const messageElement = document.getElementById('message');
            const params = new URLSearchParams(window.location.search);
            const token = params.get('token');

            if (token) {
                statusElement.className = 'success';
                statusElement.textContent = 'Login Berhasil!';
                messageElement.textContent = 'Mengautentikasi ekstensi Anda...';

                // Kirim pesan ke SEMUA ekstensi yang mendengarkan
                chrome.runtime.sendMessage({ 
                    action: "loginSuccess",
                    token: token 
                }, (response) => {
                    if (chrome.runtime.lastError) {
                        statusElement.className = 'error';
                        statusElement.textContent = 'Gagal!';
                        messageElement.textContent = 'Buka popup ekstensi Anda sekali, lalu refresh halaman ini.';
                    } else {
                        messageElement.textContent = 'Sukses! Anda bisa menutup tab ini sekarang.';
                        setTimeout(() => window.close(), 2000); // Tutup tab setelah 2 detik
                    }
                });
            } else {
                statusElement.className = 'error';
                statusElement.textContent = 'Gagal!';
                messageElement.textContent = 'Token tidak ditemukan. Silakan coba login kembali.';
            }
        });
    </script>
</body>
</html>
